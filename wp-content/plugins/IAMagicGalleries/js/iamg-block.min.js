/*
 * Copyright © 2023  Information Aesthetics. All rights reserved.
 * This work is licensed under the GPL2, V2 license.
 */

/*
 * Copyright © 2023  Information Aesthetics. All rights reserved.
 * This work is licensed under the GPL2, V2 license.
 */

/*! ia-designer 06-11-2023
Copyright: Information Aesthetics, License:  GPL2, V2/*/

!function(){const t=wp.element.createElement,e=iap_loader_settings,i=wp.i18n.__;let o,n=0,r={};window.glob_props=r,wp.blocks.registerBlockType("ia-mg/gallery",{title:i("IA Magic Gallery"),icon:"format-gallery",category:"media",supports:{align:!0},example:{},attributes:{presentation:{type:"string"},pres_id:{type:"string"},block_id:{type:"string"},behavior:{type:"string",default:"fixed"},height:{type:"number",default:100},height_percent:{type:"boolean",default:!0},properties:{type:"string",default:""},background_color:{type:"string",default:"#fff"},background_opacity:{type:"number",default:0}},usesContext:["postId"],edit:function(l){o=l.context.postId,u=l.clientId,l.attributes.block_id||l.setAttributes({block_id:u}),!l.attributes.pres_id&&l.attributes.block_id&&function(t){l.setAttributes({pres_id:t})}(l.attributes.block_id);var u;l.attributes.block_id&&l!==r[l.attributes.block_id]&&(r[l.attributes.block_id]=l);const h=Object.assign({},e.settings),d={load_condition:function(){return jQuery(".interface-interface-skeleton__content  .IA_Presenter_Container").length},after_callback:function(t){if(a||!window.eve_ia)return;t.properties;a=!0,eve_ia.on(["global","iamg","gallery","save"],function(t){const e=this,n=e.getBlockId(),a=r[n];let l=a.attributes.pres_id;const s={command:"save",block_id:n,pres_id:l,post_id:o};e.comManager.wpCommand(s,function(t){let o=t.settings?JSON.stringify(t.settings):"";a.setAttributes({properties:o}),e.eve("gui.alert",i("Gallery is saved successfully")+".",[200,100],[i("OK")]),wp.data.dispatch("core/editor").savePost()},function(t){})}),eve_ia.on(["global","iamg","gallery","removed"],function(t){const e=this.getBlockId(),i=r[e];let a=i.attributes.pres_id;n=Math.max(n-1,0);const l={command:"remove",block_id:e,pres_id:a,post_id:o};this.comManager.wpCommand(l,function(t){},function(t){})}),eve_ia.on(["ia","gui","created"],function(t){const e=this;if(window.MutationObserver){let t=new MutationObserver(function(t){e.eve("gui.panel.resize")});const i=e.div_container.node.parentNode;t.observe(i,{attributes:!0,attributeOldValue:!1,attributeFilter:["data-align"]})}if(window.ResizeObserver){let t=new ResizeObserver(function(t){e.eve("gui.panel.resize")});const i=document.getElementsByClassName("interface-interface-skeleton__content")[0];t.observe(i)}n++,e.eve.once(["presenter","loaded"],function(t){const e=t.getBlockId();let i=r[e].attributes,o=i.properties;o&&(o=JSON.parse(o));i.background_color&&t.setPanelStyle({fill:i.background_color,opacity:i.background_opacity});if(!o.type)return;const n=o.type;let a=o.images||[];const l=o.requested_images||[],s=o.resource;let c,u;for(let t in o)o.hasOwnProperty(t)&&t.startsWith(n)&&((c=c||{})[t]=o[t]);u=function(t,e){const i=[];let o=e.length;for(let n,r=0;r<t.length;r++){n=t[r].title;for(let a=0;a<o;a++){let l=e[(r+a)%o];if(n===l.title){i.push({id:n+"_"+l.id,url:t[r].thumbnail.url,title:n});break}}}return i}(a,l),t.eve(["iamg","load_gallery_setup"],void 0,n,u,c,s)}.bind(void 0,e))(100)})}.bind(void 0,l.attributes)};setTimeout(()=>{window.IA_Presenter_loader&&IA_Presenter_loader(h,void 0,e.resources,d)},5);let p=l.attributes.height;l.attributes.height_percent&&(p+="vh");if(!p||"100vh"===p){let t=0;const e=jQuery(".interface-interface-skeleton__header");e.length&&(t=e.height());const i=jQuery(".interface-interface-skeleton__footer");i.length&&(t+=i.height()),p="calc(100vh - "+t+"px)"}return t("div",{className:"IA_Presenter_Container","data-block-id":l.attributes.block_id,presentation:l.attributes.pres_id?l.attributes.pres_id:"",behavior:"fixed",style:{height:p}},function(){const e=t("svg",{width:20,height:20},t("path",{d:"M9.851,4.471c2.67,2.092,5.318,4.2,7.988,6.3l.049,4.5c-2.671-2.2-5.3-4.445-7.992-6.65C7.318,10.9,4.761,13.193,2.16,15.489c-.037-1.5-.032-3-.048-4.5C4.691,8.821,7.293,6.655,9.851,4.471ZM10.106,20q-2.227-1.751-4.48-3.5l-.039-2.805c1.5,1.21,2.979,2.429,4.481,3.638,1.435-1.261,2.869-2.533,4.3-3.795.026.934.027,1.868.04,2.8C13,17.559,11.546,18.779,10.106,20ZM20,0H0V1.2H20Z"}));let o=t(wp.blockEditor.BlockIcon,{icon:e});return t(wp.blockEditor.BlockControls,{key:"controls"},t(wp.components.ToolbarButton,{icon:o,label:i("Toggle toolbar"),onClick:()=>{wp.data.dispatch("core/edit-post").toggleFeature("fixedToolbar"),setTimeout(()=>Object.values(IA_Designer.guis).forEach(t=>t.eve("gui.panel.resize")),100)}}))}(),function(e){if(!s())return;const o="fixed"!==e.attributes.behavior,n=t("svg",{width:20,height:20},t("path",{d:"M6.368.937a1.016,1.016,0,0,1,.513.092.871.871,0,0,1,.256.919.482.482,0,0,1-.6.367c-.855,0-1.795.092-2.65.092l4.1,4.411a.692.692,0,0,1-.171,1.01.624.624,0,0,1-.855-.092L2.949,3.418c0,.919,0,1.838-.085,2.848a.866.866,0,0,1-.256.643c-.257.276-.684.184-.941-.183a1.253,1.253,0,0,1-.085-.552c0-1.47.085-2.94.085-4.41a.765.765,0,0,1,.684-.735C3.719,1.029,5.086,1.029,6.368.937Zm11.281.092a.7.7,0,0,1,.684.735c.085,1.47.085,2.94.085,4.41a1.253,1.253,0,0,1-.085.552.654.654,0,0,1-.941.183.739.739,0,0,1-.256-.643c0-.919,0-1.837-.085-2.848L13.034,7.736a.615.615,0,0,1-.855.092.692.692,0,0,1-.171-1.01l4.1-4.411c-.855,0-1.795-.092-2.65-.092a.566.566,0,0,1-.6-.367.682.682,0,0,1,.256-.919,1.016,1.016,0,0,1,.513-.092C15,1.029,16.281,1.029,17.649,1.029ZM2.351,18.854a.7.7,0,0,1-.684-.736c-.085-1.47-.085-2.94-.085-4.41a1.251,1.251,0,0,1,.085-.551.655.655,0,0,1,.941-.184.741.741,0,0,1,.256.643c0,.919,0,1.838.085,2.849l4.017-4.319a.616.616,0,0,1,.855-.091.692.692,0,0,1,.171,1.01l-4.1,4.41c.855,0,1.8.092,2.65.092a.567.567,0,0,1,.6.368.682.682,0,0,1-.256.919,1.026,1.026,0,0,1-.513.091C5.086,18.945,3.719,18.854,2.351,18.854Zm11.281.091a1.026,1.026,0,0,1-.513-.091.871.871,0,0,1-.256-.919.483.483,0,0,1,.6-.368c.855,0,1.8-.092,2.65-.092l-4.1-4.41a.692.692,0,0,1,.171-1.01.625.625,0,0,1,.855.091l4.017,4.319c0-.919,0-1.838.085-2.849a.869.869,0,0,1,.256-.643c.257-.275.684-.183.941.184a1.251,1.251,0,0,1,.085.551c0,1.47-.085,2.94-.085,4.41a.765.765,0,0,1-.684.736C16.281,18.854,15,18.945,13.632,18.945ZM20,20H0V0H20ZM.471,19.529H19.529V.471H.471Z"}),o?t("path",{fill:"#BC1F47",d:"M0.5,20.3c-0.2,0-0.4-0.1-0.5-0.2c-0.3-0.3-0.3-0.8,0-1.1L19-0.1c0.3-0.3,0.8-0.3,1.1,0s0.3,0.8,0,1.1L1,20.1C0.9,20.2,0.7,20.3,0.5,20.3z"}):null);let r=t(wp.blockEditor.BlockIcon,{icon:n});return t(wp.blockEditor.BlockControls,{key:"controls"},t(wp.components.ToolbarButton,{icon:r,label:i(o?"Set to Fixed Placement on Page":"Set to Full Page Gallery (Alignment is disregarded)"),onClick:()=>{c(!o,e,!0)}}))}(l),function(e){if("fixed"!==e.attributes.behavior)return;const o=t("svg",{width:20,height:20},t("path",{d:"M0,0v20h20V0H0z M19.5,19.5H0.5V0.5h19.1V19.5z M10.1,19.1C10,19.1,10,19.1,10.1,19.1c-0.2,0-0.4,0-0.5-0.1l-2.9-2.9c-0.2-0.2-0.2-0.5,0-0.7s0.5-0.2,0.7,0l2.1,2.1v-6.4c0-0.3,0.2-0.5,0.5-0.5s0.5,0.2,0.5,0.5v6.4l2.1-2.1c0.2-0.2,0.5-0.2,0.7,0s0.2,0.5,0,0.7l-2.9,2.9C10.3,19,10.2,19.1,10.1,19.1z M10,9.6c-0.3,0-0.5-0.2-0.5-0.5V2.7L7.4,4.8C7.2,5,6.9,5,6.7,4.8s-0.2-0.5,0-0.7l2.9-2.9C9.7,1.1,9.8,1.1,10,1.1c0.1,0,0.3,0,0.4,0.1l2.9,2.9c0.2,0.2,0.2,0.5,0,0.7s-0.5,0.2-0.7,0l-2.1-2.1v6.4C10.5,9.4,10.3,9.6,10,9.6z"}));let n=t(wp.blockEditor.BlockIcon,{icon:o});return t(wp.blockEditor.BlockControls,{key:"controls"},t(wp.components.ToolbarDropdownMenu,{icon:n,label:i("Height (Check Settings for more options)"),controls:[{title:"100%",onClick:()=>{e.setAttributes({height:100,height_percent:!0})}},{title:"75%",onClick:()=>{e.setAttributes({height:75,height_percent:!0})}},{title:"50%",onClick:()=>{e.setAttributes({height:50,height_percent:!0})}},{title:"25%",onClick:()=>{e.setAttributes({height:25,height_percent:!0})}}]}))}(l),function(e){let o=e.attributes.block_id;e.attributes.behavior;let n,r="IAMG_Height_Panel_"+o;window.IA_Designer&&(n=IA_Designer.getGui(t=>t.getBlockId()===o));const a="fixed"!==e.attributes.behavior;let l=e.attributes.height_percent?t(wp.components.Button,{isDefault:!0,onClick:()=>{e.setAttributes({height_percent:!1});const t=e.attributes.height*(window.innerHeight-0)/100;e.setAttributes({height:t})}},"%"):t(wp.components.Button,{isDefault:!0,onClick:()=>{e.setAttributes({height_percent:!0});const t=100*e.attributes.height/(window.innerHeight-0);e.setAttributes({height:t})},marginTop:"auto"},"Px"),s=a?void 0:t(wp.components.PanelBody,{title:i("Height"),initialOpen:!0,className:r},t(wp.components.PanelRow,{},t("div",{},t(wp.components.TextControl,{type:"number",onChange:t=>{e.setAttributes({height:t})},value:e.attributes.height||"",class:"IAMG_Layout_HalfWidth"}),l))),u=t(wp.components.PanelBody,{title:i("Layout"),initialOpen:!0,className:"IAMG_Layout_Panel_"+o},t(wp.components.PanelRow,{},t(wp.components.ToggleControl,{label:i("Fixed (or Full)"),onChange:t=>{c(t,e,!0)},checked:"fixed"!==e.attributes.behavior})),t(wp.components.PanelRow,{},t("text",{},i(a?"The gallery will take the full page. Only one full gallery can be placed on a page as all other elements will be removed.":"The gallery will have fixed location in the page. Set the height behavior below!")))),h=e.attributes.background_color,d=t(wp.components.PanelBody,{title:i("Background Color"),initialOpen:!0},t(wp.components.PanelRow,{},t(wp.blockEditor.PanelColorSettings,{colorSettings:[{value:h,onChange:t=>{e.setAttributes({background_color:t}),n&&n.setPanelStyle("fill",t)},label:i("Color")}],className:"IAMG_Layout_FullWidth"})),t(wp.components.PanelRow,{},t(wp.components.RangeControl,{label:i("Opacity"),onChange:t=>{e.setAttributes({background_opacity:t}),n&&n.setPanelStyle("opacity",t)},value:e.attributes.background_opacity||0,min:0,max:100,className:"IAMG_Layout_FullWidth"})));return t(wp.blockEditor.InspectorControls,{},u,s,d)}(l))},save:function(e){if(e.attributes.pres_id){let i=function(t){let e=" ";return Object.keys(t).forEach(i=>{const o=t[i];"object"==typeof o?Object.keys(o).forEach(t=>{e+=" "+i+"_"+t+'="'+o[t]+'"'}):e+=" "+i+'="'+o+'"'}),e}({behavior:e.attributes.behavior,height:e.attributes.height,height_type:e.attributes.height_percent?"percent":"pixel",background_color:e.attributes.background_color,background_opacity:e.attributes.background_opacity}),o=t("div",{},'[ia_magic_gallery id="'+e.attributes.pres_id+'"'+i+"]");return o}{let e=t("div",{},'[ia_magic_gallery id="demo"]');return e}}});let a=!1;let l={};function s(){return 1===n}function c(t,e,i){t&&s()&&(l.height=e.attributes.height,l.height_percent=e.attributes.height_percent,e.setAttributes({behavior:"full",height:100,height_percent:!0})),t||(i&&"full"===e.attributes.behavior&&l.hasOwnProperty("height")?e.setAttributes({height:l.height,height_percent:l.height_percent,behavior:"fixed"}):e.setAttributes({behavior:"fixed"}))}}();
//# sourceMappingURL=iamg-block.min.js.map