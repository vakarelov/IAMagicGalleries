/*! ia-designer 09-02-2024 
Copyright Â© 2023 Information Aesthetics. All rights reserved.
This work is licensed under the GPL2, V2/ license.*/

!function(){const e=wp.element.createElement,t=iap_loader_settings,i=wp.i18n.__;let o,n=0,r={},l=t.wp_version&&parseFloat(t.wp_version)<5.8?"widgets":"media";wp.blocks.registerBlockType("ia-mg/gallery",{title:i("IA Magic Gallery"),icon:"format-gallery",category:l,supports:{align:!0},example:{},attributes:{presentation:{type:"string"},pres_id:{type:"string"},block_id:{type:"string"},behavior:{type:"string",default:"fixed"},height:{type:"number",default:100},height_percent:{type:"boolean",default:!0},properties:{type:"string",default:""},background_color:{type:"string",default:"#fff"},background_opacity:{type:"number",default:0}},usesContext:["postId"],edit:function(l){o=l.context?l.context.postId:null,s=l.clientId,l.attributes.block_id||l.setAttributes({block_id:s}),!l.attributes.pres_id&&l.attributes.block_id&&function(e){l.setAttributes({pres_id:e})}(l.attributes.block_id);var s;l.attributes.block_id&&l!==r[l.attributes.block_id]&&(r[l.attributes.block_id]=l);const d=Object.assign({},t.settings),h={load_condition:function(){let e=document.querySelectorAll(".interface-interface-skeleton__content .IA_Presenter_Container");if(e.length)return!0;let t=document.querySelector('iframe[name="editor-canvas"]');if(t){let e=t.contentDocument||t.contentWindow.document,i=e.querySelectorAll(".IA_Presenter_Container");return i.length}return!1},after_callback:function(e){if(a||!window.eve_ia)return;a=!0,eve_ia.on(["global","iamg","gallery","save"],function(e){const t=this,n=t.getBlockId(),l=r[n];let a=l.attributes.pres_id;const s={command:"save",block_id:n,pres_id:a,post_id:o,locator:e};t.comManager.wpCommand(s,function(e){let o={margin:{top:10,bottom:5,left:10,right:5}};if(e.error)return t.eve("gui.alert",i("Gallery was not saved successfully")+".",[220,70],[i("OK")],[],o),t.eve("gui.error",e.error),submit_button&&(submit_button.disabled=!1),void(save_button&&(save_button.disabled=!1));let n=e.settings?JSON.stringify(e.settings):"";l.setAttributes({properties:n}),t.eve("gui.alert",i("Gallery is saved successfully")+".",[200,70],[i("OK")],void 0,o),wp.data.dispatch("core/editor").savePost()},function(e){})}),eve_ia.on(["global","iamg","gallery","removed"],function(e){const t=this.getBlockId(),i=r[t];let l=i.attributes.pres_id;n=Math.max(n-1,0);const a={command:"remove",block_id:t,pres_id:l,post_id:o,locator:e};this.comManager.wpCommand(a,function(e){},function(e){})}),eve_ia.on(["ia","gui","created"],function(e){const t=this;if(Snap_ia.window().MutationObserver){let e=new MutationObserver(function(e){t.eve("gui.panel.resize")});const i=t.div_container.node.parentNode;i&&e.observe(i,{attributes:!0,attributeOldValue:!1,attributeFilter:["data-align","class"]})}if(Snap_ia.window().ResizeObserver){let e=new ResizeObserver(function(e){t.eve("gui.panel.resize")});const i=document.getElementsByClassName("interface-interface-skeleton__content")[0];i&&e.observe(i)}n++,t.eve.once(["presenter","loaded"],function(e){const t=e.getBlockId();let i=r[t].attributes,o=i.properties;o&&(o=JSON.parse(o));i.background_color&&e.setPanelStyle({fill:i.background_color,fillOpacity:i.background_opacity/100});if(!o.type)return;const n=o.type;let l=o.images||[];const a=o.requested_images||[],s=o.resource;let c,u;for(let e in o)o.hasOwnProperty(e)&&e.startsWith(n)&&((c=c||{})[e]=o[e]);u=function(e,t){const i=[];let o=t.length;for(let n,r=0;r<e.length;r++){n=e[r].title;for(let l=0;l<o;l++){let a=t[(r+l)%o];if(n===a.title){i.push({id:n+"_"+a.id,url:e[r].thumbnail.url,title:n});break}}}return i}(l,a),e.eve(["iamg","load_gallery_setup"],void 0,n,u,c,s)}.bind(void 0,t))(100)})}.bind(void 0,l.attributes)};setTimeout(()=>{window.IA_Presenter_loader&&IA_Presenter_loader(d,void 0,t.resources,h)},5);let g=l.attributes.height;l.attributes.height_percent&&(g+="vh");if(!g||"100vh"===g){let e=0;const t=jQuery(".interface-interface-skeleton__header");t.length&&(e=t.height());const i=jQuery(".interface-interface-skeleton__footer");i.length&&(e+=i.height()),g="calc(100vh - "+e+"px)"}return e("div",{className:"IA_Presenter_Container","data-block-id":l.attributes.block_id,presentation:l.attributes.pres_id?l.attributes.pres_id:"",behavior:"fixed",style:{height:g}},function(){const t=e("svg",{width:20,height:20},e("path",{d:"M9.851,4.471c2.67,2.092,5.318,4.2,7.988,6.3l.049,4.5c-2.671-2.2-5.3-4.445-7.992-6.65C7.318,10.9,4.761,13.193,2.16,15.489c-.037-1.5-.032-3-.048-4.5C4.691,8.821,7.293,6.655,9.851,4.471ZM10.106,20q-2.227-1.751-4.48-3.5l-.039-2.805c1.5,1.21,2.979,2.429,4.481,3.638,1.435-1.261,2.869-2.533,4.3-3.795.026.934.027,1.868.04,2.8C13,17.559,11.546,18.779,10.106,20ZM20,0H0V1.2H20Z"}));let o=e(wp.blockEditor.BlockIcon,{icon:t});return e(wp.blockEditor.BlockControls,{key:"toggle_toolbak"},e(wp.components.ToolbarButton,{icon:o,label:i("Toggle toolbar"),onClick:()=>{wp.data.dispatch("core/edit-post").toggleFeature("fixedToolbar"),setTimeout(()=>Object.values(IA_Designer.guis).forEach(e=>e.eve("gui.panel.resize")),100)}}))}(),function(t){if(!c())return;const o="fixed"!==t.attributes.behavior,n=e("svg",{width:20,height:20},e("path",{d:"M6.368.937a1.016,1.016,0,0,1,.513.092.871.871,0,0,1,.256.919.482.482,0,0,1-.6.367c-.855,0-1.795.092-2.65.092l4.1,4.411a.692.692,0,0,1-.171,1.01.624.624,0,0,1-.855-.092L2.949,3.418c0,.919,0,1.838-.085,2.848a.866.866,0,0,1-.256.643c-.257.276-.684.184-.941-.183a1.253,1.253,0,0,1-.085-.552c0-1.47.085-2.94.085-4.41a.765.765,0,0,1,.684-.735C3.719,1.029,5.086,1.029,6.368.937Zm11.281.092a.7.7,0,0,1,.684.735c.085,1.47.085,2.94.085,4.41a1.253,1.253,0,0,1-.085.552.654.654,0,0,1-.941.183.739.739,0,0,1-.256-.643c0-.919,0-1.837-.085-2.848L13.034,7.736a.615.615,0,0,1-.855.092.692.692,0,0,1-.171-1.01l4.1-4.411c-.855,0-1.795-.092-2.65-.092a.566.566,0,0,1-.6-.367.682.682,0,0,1,.256-.919,1.016,1.016,0,0,1,.513-.092C15,1.029,16.281,1.029,17.649,1.029ZM2.351,18.854a.7.7,0,0,1-.684-.736c-.085-1.47-.085-2.94-.085-4.41a1.251,1.251,0,0,1,.085-.551.655.655,0,0,1,.941-.184.741.741,0,0,1,.256.643c0,.919,0,1.838.085,2.849l4.017-4.319a.616.616,0,0,1,.855-.091.692.692,0,0,1,.171,1.01l-4.1,4.41c.855,0,1.8.092,2.65.092a.567.567,0,0,1,.6.368.682.682,0,0,1-.256.919,1.026,1.026,0,0,1-.513.091C5.086,18.945,3.719,18.854,2.351,18.854Zm11.281.091a1.026,1.026,0,0,1-.513-.091.871.871,0,0,1-.256-.919.483.483,0,0,1,.6-.368c.855,0,1.8-.092,2.65-.092l-4.1-4.41a.692.692,0,0,1,.171-1.01.625.625,0,0,1,.855.091l4.017,4.319c0-.919,0-1.838.085-2.849a.869.869,0,0,1,.256-.643c.257-.275.684-.183.941.184a1.251,1.251,0,0,1,.085.551c0,1.47-.085,2.94-.085,4.41a.765.765,0,0,1-.684.736C16.281,18.854,15,18.945,13.632,18.945ZM20,20H0V0H20ZM.471,19.529H19.529V.471H.471Z"}),o?e("path",{fill:"#BC1F47",d:"M0.5,20.3c-0.2,0-0.4-0.1-0.5-0.2c-0.3-0.3-0.3-0.8,0-1.1L19-0.1c0.3-0.3,0.8-0.3,1.1,0s0.3,0.8,0,1.1L1,20.1C0.9,20.2,0.7,20.3,0.5,20.3z"}):null);let r=e(wp.blockEditor.BlockIcon,{icon:n});return e(wp.blockEditor.BlockControls,{key:"element_fullscreen"},e(wp.components.ToolbarButton,{icon:r,label:i(o?"Set to Fixed Placement on Page":"Set to Full Page Gallery (Alignment is disregarded)"),onClick:()=>{u(!o,t,!0)}}))}(l),function(t){if("fixed"!==t.attributes.behavior)return;const o=e("svg",{width:20,height:20},e("path",{d:"M0,0v20h20V0H0z M19.5,19.5H0.5V0.5h19.1V19.5z M10.1,19.1C10,19.1,10,19.1,10.1,19.1c-0.2,0-0.4,0-0.5-0.1l-2.9-2.9c-0.2-0.2-0.2-0.5,0-0.7s0.5-0.2,0.7,0l2.1,2.1v-6.4c0-0.3,0.2-0.5,0.5-0.5s0.5,0.2,0.5,0.5v6.4l2.1-2.1c0.2-0.2,0.5-0.2,0.7,0s0.2,0.5,0,0.7l-2.9,2.9C10.3,19,10.2,19.1,10.1,19.1z M10,9.6c-0.3,0-0.5-0.2-0.5-0.5V2.7L7.4,4.8C7.2,5,6.9,5,6.7,4.8s-0.2-0.5,0-0.7l2.9-2.9C9.7,1.1,9.8,1.1,10,1.1c0.1,0,0.3,0,0.4,0.1l2.9,2.9c0.2,0.2,0.2,0.5,0,0.7s-0.5,0.2-0.7,0l-2.1-2.1v6.4C10.5,9.4,10.3,9.6,10,9.6z"}));let n=e(wp.blockEditor.BlockIcon,{icon:o});return e(wp.blockEditor.BlockControls,{key:"height_menu"},e(wp.components.ToolbarDropdownMenu,{icon:n,label:i("Height (Check Settings for more options)"),controls:[{title:"100%",onClick:()=>{t.setAttributes({height:100,height_percent:!0})}},{title:"75%",onClick:()=>{t.setAttributes({height:75,height_percent:!0})}},{title:"50%",onClick:()=>{t.setAttributes({height:50,height_percent:!0})}},{title:"25%",onClick:()=>{t.setAttributes({height:25,height_percent:!0})}}]}))}(l),function(t){let o=t.attributes.block_id;t.attributes.behavior;let n,r="IAMG_Height_Panel_"+o;window.IA_Designer&&(n=IA_Designer.getGui(e=>e.getBlockId()===o));const l="fixed"!==t.attributes.behavior;let a=t.attributes.height_percent?e(wp.components.Button,{isDefault:!0,onClick:()=>{t.setAttributes({height_percent:!1});const e=t.attributes.height*(window.innerHeight-0)/100;t.setAttributes({height:e})}},"%"):e(wp.components.Button,{isDefault:!0,onClick:()=>{t.setAttributes({height_percent:!0});const e=100*t.attributes.height/(window.innerHeight-0);t.setAttributes({height:e})},marginTop:"auto"},"Px"),s=l?void 0:e(wp.components.PanelBody,{title:i("Height"),initialOpen:!0,className:r},e(wp.components.PanelRow,{},e("div",{},e(wp.components.TextControl,{type:"number",onChange:e=>{t.setAttributes({height:e})},value:t.attributes.height||"",class:"IAMG_Layout_HalfWidth"}),a))),d=e(wp.components.PanelBody,{title:i("Layout"),initialOpen:!0,className:"IAMG_Layout_Panel_"+o},e(wp.components.PanelRow,{},e(wp.components.ToggleControl,{label:i("Fixed (or Full)"),onChange:e=>{u(e,t,!0)},checked:"fixed"!==t.attributes.behavior})),e(wp.components.PanelRow,{},e("text",{},i(l?"The gallery will take the full page. Only one full gallery can be placed on a page as all other elements will be removed.":"The gallery will have fixed location in the page. Set the height behavior below!")))),h=t.attributes.background_color,g=e(wp.components.PanelBody,{title:i("Background Color"),initialOpen:!0},e(wp.components.PanelRow,{},e(wp.blockEditor.PanelColorSettings,{colorSettings:[{value:h,onChange:e=>{t.setAttributes({background_color:e}),n&&n.setPanelStyle({fill:e})},label:i("Color")}],className:"IAMG_Layout_FullWidth"})),e(wp.components.PanelRow,{},e(wp.components.RangeControl,{label:i("Opacity"),onChange:e=>{t.setAttributes({background_opacity:e}),n&&n.setPanelStyle({fillOpacity:e/100})},value:t.attributes.background_opacity||0,min:0,max:100,className:"IAMG_Layout_FullWidth"})));return e(wp.blockEditor.InspectorControls,{},c()?d:null,s,g)}(l))},save:function(t){if(t.attributes.pres_id){let i=function(e){let t=" ";return Object.keys(e).forEach(i=>{const o=e[i];"object"==typeof o?Object.keys(o).forEach(e=>{t+=" "+i+"_"+e+'="'+o[e]+'"'}):t+=" "+i+'="'+o+'"'}),t}({behavior:t.attributes.behavior,height:t.attributes.height,height_type:t.attributes.height_percent?"percent":"pixel",background_color:t.attributes.background_color,background_opacity:t.attributes.background_opacity}),o=e("div",{},'[ia_magic_gallery id="'+t.attributes.pres_id+'"'+i+"]");return o}{let t=e("div",{},'[ia_magic_gallery id="demo"]');return t}}});let a=!1;let s={};function c(){return 1===n}function u(e,t,i){e&&c()&&(s.height=t.attributes.height,s.height_percent=t.attributes.height_percent,t.setAttributes({behavior:"full",height:100,height_percent:!0})),e||(i&&"full"===t.attributes.behavior&&s.hasOwnProperty("height")?t.setAttributes({height:s.height,height_percent:s.height_percent,behavior:"fixed"}):t.setAttributes({behavior:"fixed"}))}}();