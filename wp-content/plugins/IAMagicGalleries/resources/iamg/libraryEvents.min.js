/*
 * Copyright © 2023  Information Aesthetics. All rights reserved.
 * This work is licensed under the GPL2, V2 license.
 */

/*
 * Copyright © 2023  Information Aesthetics. All rights reserved.
 * This work is licensed under the GPL2, V2 license.
 */

!function(){const e=!1;e&&console.log("In Library events");IA_Designer.addButtonFunction("iamg_image_library_json_converter",function(e){const t=this.defs.image(e.url,0,0,e.width,e.height,{id:e.title+"_"+e.id}),i=[e.full];return e.large&&i.push(e.large),e.medium&&i.push(e.medium),t.data({id:e.id,sizes:i,media:"image"}),t});IA_Designer.addButtonFunction("iamg_video_library_json_converter",function(e){const t=this;let i;if(e.thumbnail)i=t.defs.image(e.thumbnail.url,0,0,e.thumbnail.width,e.thumbnail.height,{id:"lib_"+e.title});else{const n=e.height/e.width,o=(i=t.defs.g().attr({id:"lib_"+e.title})).rect(0,0,200,200*n,{fill:"#555555"});i.text(0,0,e.title).attr({id:"lib_text_"+e.title,fontSize:32,fill:"white"}).fitInBox(o.getBBox(),!0,!0)}return i.data({id:e.id,sizes:[[e.url,e.width,e.height]],media:"video"}),i});let t=IA_Designer.getGui(),i={};window.added_elements=i;let n,o,a,l={};function d(e,a,l,d){g&&g.remove();const r=e.getId();if(o=o||t.eve(["widget","panel","getPanel","included_images"]).firstDefined(),window.panel_lib=o,o){if(i[r])d||(e.attr("opacity",1),i[r]=void 0,o.externalUpdate({selected_images:[r,-1]}));else{const a=e.clone(),d=l.place.clone();d.repositionInGroup(t.overlay),e.attr("opacity",.3),i[e.getId()]=e,o.externalUpdate({selected_images:[a,void 0,300]}),t.eve(["widget","elementList","toBottom","selected_images"]);const r=o.getBBox(),s=(n||(n=t.eve(["widget","elementList","get","selected_images"]).firstDefined()),n).getBBox(),g=d.getBBox().height;d.animateTransform(Snap_ia.matrix().translate(t.panelWidth+s.x,r.y+s.y2-g),300,void 0,()=>d.remove())}t.eve("controller.included_images.open")}}function r(e){e.animate({opacity:0},200,mina.linear,()=>e.remove())}window.added_elements_external=l,t.eve.on("iamg.addImage",d),t.eve.on(["widget","elementList","update","selected_images"],function(n,o){let a=!1;if(o)i[o]&&(i[o].attr("opacity",1),i[o]=void 0),l[o]&&(l[o]=void 0);else for(var d=0;d<n.length;++d)i[n[d]]||l[n[d]]||(l[n[d]]=!0,a=!0);a&&Object.values(t.libraries).forEach(e=>s(e)),e&&console.log("Element List",n,o)});function s(e){const t=(e||this).getElements().filter(Boolean);if(t&&t.length)for(let e=0;e<t.length;e++){let n=t[e].getId();l[n]&&(t[e].attr("opacity",.3),i[n]=t[e],l[n]=void 0)}}let g;["iamg_image_library","iamg_video_library"].forEach(e=>{t.eve.on(["library",e,"home_change"],s)}),t.eve.on("iamg.clikedImage",function(i,n,o){const l=this,d=i.data("sizes");if(d){if(g){if(d.find(e=>e[0]===g.attr("href")))return r(g),void(g=void 0);r(g),g=void 0}a=a||2.6*l.getWidth();const e=t.panelWidth-a,i=t.panelHeight-50;let n=d[0][0];for(let t=0,o=Number.MAX_VALUE;t<d.length;t++)(d[t][1]>.75*e||d[t][2]>.75*i)&&d[t][1]<o&&(o=d[t][1],n=d[t][0]);let s=Snap_ia(o.target);const c=s.getBBox().center(),m=Snap_ia.groupToGroupChangeOfBase(s,t.centerGroup).apply(c);(g=t.centerGroup.image(n,m.x,m.y,0,0,{preserveAspectRatio:"xMidYMid"})).animate({x:-e/2,y:-i/2,width:e,height:i},250),g.click(()=>{r(g),g=void 0})}e&&console.log("Image Clicked",n)}),t.eve.on("iamg.region_select",function(e,t){const i=this.locations;t.forEach((e,t)=>{const n=e[0];t?setTimeout(()=>d(e[1],0,i[n],!0),64*t):d(e[1],0,i[n],!0)})}),t.eve.on(["gui","panel","resized"],function(){if(g){const e=t.panelWidth-a,i=t.panelHeight-20;g.attr({x:-e/2,y:-i/2,width:e,height:i})}}),t.eve.on(["gui","panel","clickEnd"],()=>{g&&(r(g),g=void 0)})}();